{% extends "auctions/layout.html" %}

{% block body %}
    <h2>Listing: {{ auction.title }} [{{ auction.status }}]</h2>
    <h5>Winner: {{ auction.winner }}</h5>
    {% if user.is_authenticated %}
        {% if is_in_watchlist %}
            <form action="{% url 'toggle_watchlist' auction.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="Remove from Watchlist">
            </form>
        {% else %}
            <form action="{% url 'toggle_watchlist' auction.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="Add from Watchlist">
            </form>
        {% endif %}
    {% endif %}

    {% if auction.image_url %}
        <div>
            <img src="{{ auction.image_url }}" alt="{{ auction.title }}" style="width: 20%; height: 20%;">
        </div>
    {% endif %}
    <div>
        <p>{{ auction.description }}</p>
        {% if current_bid %}
            <p>${{ current_bid }}</p>
        {% else %}
            <p>${{ auction.starting_bid }}</p>
        {% endif %}
        {% if auction.status == 'Open' and request.user != auction.auctioneer %}
            <form action="{% url 'place_bid' auction.id %}" method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Place Bid">
            </form>
            {% if messages %}
                <ul>
                    {% for message in messages %}
                        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                            {{ message }}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endif %}
        <h5>Details:</h5>
        <ul>
            <li>Listing Status: {{ auction.status }}</li>
            <li>Category: {{ auction.category }}</li>
            <li>Listed by {{ auction.auctioneer }}</li>
            <li>Created {{ auction.date_created }}</li>
        </ul>
    </div>
    {% if request.user == auction.auctioneer and auction.status == 'Open' %}
    <div>
        <form action="{% url 'close_listing' auction.id%}" method="POST">
            {% csrf_token %}
            <input type="submit" value="Close Listing">
        </form>
        {% if messages %}
            <ul>
                {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                        {{ message }}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    {% endif %}
    <div>
        <form action="{% url 'add_comment' auction.id %}" method="POST">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <input type="submit" value="Add Comment">
        </form>
        <div>
            {% if comments %}
                {% for comment in comments %}
                    <div>
                        <p>"{{ comment.comment }}" By {{ comment.commenter }}</p>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
{% endblock %}